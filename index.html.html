<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Priya Borewell - Invoice with Time & Save Logic</title>
  <style>
    body { font-family: Arial; background: #f2f2f2; padding: 20px; }
    .section { max-width: 900px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px #ccc; margin-bottom: 20px; }
    input, select, button { padding: 8px; margin: 5px 0; width: 100%; box-sizing: border-box; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #007bff; color: white; }
    .hidden { display: none; }
    .btn { background-color: #28a745; color: white; border: none; cursor: pointer; }
    .admin-section { background-color: #ddd; padding: 10px; margin-bottom: 20px; }
    .admin-btn { background-color: #007bff; }
  </style>
</head>
<body>

<div class="admin-section">
  <h2>Admin Panel</h2>
  <label for="adminPassword">Enter Admin Password</label>
  <input type="password" id="adminPassword" />
  <button class="btn admin-btn" onclick="verifyAdmin()">Login as Admin</button>
</div>

<div class="section">
  <h2>Invoice Generator</h2>

  <!-- Machine Time -->
  <label>Machine Start Time</label>
  <input type="time" id="startTime" />
  <label>Machine End Time</label>
  <input type="time" id="endTime" />

  <input type="text" id="partyName" placeholder="Party Name" />
  <input type="text" id="partyAddress" placeholder="Address" />

  <table>
    <thead><tr><th>Item</th><th>Rate</th><th>Qty</th></tr></thead>
    <tbody id="items">
      <tr><td><input value="7 inch Casing" id="name1" /></td><td><input type="number" value="350" id="rate1" /></td><td><input type="number" value="0" id="qty1" /></td></tr>
      <tr><td><input value="5 inch Casing" id="name2" /></td><td><input type="number" value="150" id="rate2" /></td><td><input type="number" value="0" id="qty2" /></td></tr>
      <tr><td><input value="Boring" id="name3" /></td><td><input type="number" value="120" id="rate3" /></td><td><input type="number" value="0" id="qty3" /></td></tr>
      <tr><td><input value="Extra Work" id="name4" /></td><td><input type="number" value="0" id="rate4" /></td><td><input type="number" value="0" id="qty4" /></td></tr>
    </tbody>
  </table>

  <input type="number" id="advance" placeholder="Advance Payment (₹)" />
  <select id="paymentMode">
    <option value="Cash">Cash</option>
    <option value="Online">Online</option>
  </select>
  <input type="text" id="receivedBy" placeholder="Received By" />

  <button class="btn" onclick="calculate()">Calculate</button>

  <div id="output"></div>

  <div id="finalInputs" class="hidden">
    <input type="number" id="finalAmountPaid" placeholder="Total Amount Paid by Party (₹)" />
    <p><strong>Due:</strong> ₹<span id="finalDue">0</span></p>
    <button class="btn" onclick="saveData()">Save to Firebase</button>
  </div>
</div>

<!-- Firebase -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
  import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDTouQp3lyN5vuB7W2D2URlil5vnwLv9SQ",
    authDomain: "priyaborewel.firebaseapp.com",
    projectId: "priyaborewel",
    storageBucket: "priyaborewel.appspot.com",
    messagingSenderId: "372574129565",
    appId: "1:372574129565:web:71d8962d4a639c2ef43374"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  let finalTotal = 0;

  // Admin verification
  let isAdmin = false;

  window.verifyAdmin = () => {
    const adminPassword = document.getElementById("adminPassword").value;
    if (adminPassword === "admin123") {  // Replace with your actual admin password
      isAdmin = true;
      alert("Admin verified!");
      document.querySelector(".admin-section").style.display = "none";  // Hide Admin Panel after verification
    } else {
      alert("Incorrect password. Please try again.");
    }
  };

  window.calculate = () => {
    finalTotal = 0;
    let details = "";
    for (let i = 1; i <= 4; i++) {
      const name = document.getElementById(`name${i}`).value;
      const rate = parseFloat(document.getElementById(`rate${i}`).value) || 0;
      const qty = parseFloat(document.getElementById(`qty${i}`).value) || 0;
      if (qty > 0) {
        const amt = rate * qty;
        finalTotal += amt;
        details += `${name}: ₹${rate} x ${qty} = ₹${amt.toFixed(2)}\n`;
      }
    }

    const advance = parseFloat(document.getElementById("advance").value) || 0;
    const due = finalTotal - advance;

    document.getElementById("output").innerHTML = `
      <p><strong>Calculated Total:</strong> ₹${finalTotal}</p>
      <p><strong>Advance:</strong> ₹${advance}</p>
      <p><strong>Due:</strong> ₹${due}</p>
    `;

    document.getElementById("finalInputs").classList.remove("hidden");

    document.getElementById("finalAmountPaid").addEventListener("input", () => {
      const paid = parseFloat(document.getElementById("finalAmountPaid").value) || 0;
      document.getElementById("finalDue").innerText = (finalTotal - paid).toFixed(2);
    });
  };

  window.saveData = async () => {
    const paidAmount = parseFloat(document.getElementById("finalAmountPaid").value) || 0;
    const due = finalTotal - paidAmount;

    const data = {
      machineStartTime: document.getElementById("startTime").value,
      machineEndTime: document.getElementById("endTime").value,
      partyName: document.getElementById("partyName").value,
      partyAddress: document.getElementById("partyAddress").value,
      productDetails: document.getElementById("output").innerText,
      total: finalTotal,
      amountPaid: paidAmount,
      due: due,
      advance: parseFloat(document.getElementById("advance").value) || 0,
      paymentMode: document.getElementById("paymentMode").value,
      receivedBy: document.getElementById("receivedBy").value,
      date: new Date().toLocaleString()
    };

    // Only allow saving if admin is verified
    if (isAdmin) {
      await addDoc(collection(db, "invoice"), data);
      alert("Invoice saved successfully!");
      location.reload();
    } else {
      alert("You need to log in as admin to save data.");
    }
  };
</script>

</body>
</html>
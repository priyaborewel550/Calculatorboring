<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Priya Borewell - Invoice + Admin</title>
  <style>
    body { font-family: Arial; background: #f4f4f4; padding: 20px; }
    .section { background: #fff; padding: 20px; margin: auto; max-width: 900px; margin-bottom: 20px; border-radius: 10px; box-shadow: 0 0 10px #ccc; }
    h2 { text-align: center; }
    input, select, button { width: 100%; padding: 8px; margin: 5px 0; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #007bff; color: #fff; }
    .hidden { display: none; }
    .btn { background-color: #28a745; color: white; border: none; cursor: pointer; }
    .btn-blue { background-color: #007bff; }
  </style>
</head>
<body>

<div class="section">
  <h2>Invoice Generator</h2>
  <label>Machine Start Time:</label>
  <input type="time" id="startTime">
  <label>Machine End Time:</label>
  <input type="time" id="endTime">
  <input type="text" id="partyName" placeholder="Party Name" />
  <input type="text" id="partyAddress" placeholder="Address" />

  <table>
    <thead><tr><th>Item</th><th>Rate</th><th>Qty</th></tr></thead>
    <tbody id="items">
      <tr><td><input value="7 inch Casing" id="name1" /></td><td><input type="number" value="350" id="rate1" /></td><td><input type="number" value="0" id="qty1" /></td></tr>
      <tr><td><input value="5 inch Casing" id="name2" /></td><td><input type="number" value="150" id="rate2" /></td><td><input type="number" value="0" id="qty2" /></td></tr>
      <tr><td><input value="Boring" id="name3" /></td><td><input type="number" value="120" id="rate3" /></td><td><input type="number" value="0" id="qty3" /></td></tr>
      <tr><td><input value="Extra Work" id="name4" /></td><td><input type="number" value="0" id="rate4" /></td><td><input type="number" value="0" id="qty4" /></td></tr>
    </tbody>
  </table>

  <input type="number" id="advance" placeholder="Advance Payment (₹)" />
  <input type="number" id="amountPayable" placeholder="Amount Payable by Party (₹)" />
  <input type="number" id="amountPaid" placeholder="Amount Paid by Party (₹)" />
  <select id="paymentMode">
    <option value="Cash">Cash</option>
    <option value="Online">Online</option>
  </select>
  <input type="text" id="receivedBy" placeholder="Received By" />
  <button class="btn" onclick="calculateAndSave()">Calculate & Save</button>
  <div id="output"></div>
</div>

<!-- Admin Section -->
<div class="section" id="loginBox">
  <h2>Admin Login</h2>
  <input type="password" id="adminPass" placeholder="Enter Password" />
  <button class="btn-blue" onclick="checkPassword()">Login</button>
</div>

<div class="section hidden" id="dashboard">
  <h2>Invoice Records</h2>
  <table id="invoiceTable">
    <thead>
      <tr>
        <th>Party</th><th>Address</th><th>Products</th><th>Total</th>
        <th>Advance</th><th>Payable</th><th>Paid</th><th>Due</th>
        <th>Mode</th><th>Received By</th><th>Machine Time</th><th>Date</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDTouQp3lyN5vuB7W2D2URlil5vnwLv9SQ",
    authDomain: "priyaborewel.firebaseapp.com",
    projectId: "priyaborewel",
    storageBucket: "priyaborewel.appspot.com",
    messagingSenderId: "372574129565",
    appId: "1:372574129565:web:71d8962d4a639c2ef43374"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  window.calculateAndSave = async () => {
    let total = 0, details = "";
    for (let i = 1; i <= 4; i++) {
      const name = document.getElementById(`name${i}`).value;
      const rate = parseFloat(document.getElementById(`rate${i}`).value) || 0;
      const qty = parseFloat(document.getElementById(`qty${i}`).value) || 0;
      if (qty > 0) {
        const amt = rate * qty;
        total += amt;
        details += `${name}: ₹${rate} x ${qty} = ₹${amt.toFixed(2)}\n`;
      }
    }

    const advance = parseFloat(document.getElementById("advance").value) || 0;
    const payable = parseFloat(document.getElementById("amountPayable").value) || total;
    const paid = parseFloat(document.getElementById("amountPaid").value) || 0;
    const due = payable - paid;

    const data = {
      machineTime: `${document.getElementById("startTime").value} to ${document.getElementById("endTime").value}`,
      partyName: document.getElementById("partyName").value,
      partyAddress: document.getElementById("partyAddress").value,
      productDetails: details,
      total, advance,
      amountPayable: payable,
      amountPaid: paid,
      due,
      paymentMode: document.getElementById("paymentMode").value,
      receivedBy: document.getElementById("receivedBy").value,
      date: new Date().toLocaleString()
    };

    await addDoc(collection(db, "invoice"), data);
    document.getElementById("output").innerHTML = `<strong>Saved!</strong> Total: ₹${total}, Due: ₹${due}`;
  };

  const correctPassword = "priya123";
  window.checkPassword = () => {
    const input = document.getElementById("adminPass").value;
    if (input === correctPassword) {
      document.getElementById("loginBox").classList.add("hidden");
      document.getElementById("dashboard").classList.remove("hidden");
      loadInvoices();
    } else {
      alert("Incorrect password!");
    }
  };

  async function loadInvoices() {
    const snapshot = await getDocs(collection(db, "invoice"));
    const tbody = document.querySelector("#invoiceTable tbody");
    tbody.innerHTML = "";
    snapshot.forEach((doc) => {
      const d = doc.data();
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${d.partyName}</td><td>${d.partyAddress}</td><td><pre>${d.productDetails}</pre></td>
        <td>₹${d.total}</td><td>₹${d.advance}</td><td>₹${d.amountPayable}</td><td>₹${d.amountPaid}</td><td>₹${d.due}</td>
        <td>${d.paymentMode}</td><td>${d.receivedBy}</td><td>${d.machineTime}</td><td>${d.date}</td>`;
      tbody.appendChild(row);
    });
  }
</script>

</body>
</html>